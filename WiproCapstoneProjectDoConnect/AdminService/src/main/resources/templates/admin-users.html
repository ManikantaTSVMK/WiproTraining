<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>Manage Users - Do-Connect Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/admin-users.css">
    
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="header-logo">
                    <i class="fas fa-link"></i>
                </div>
                <div class="header-text">
                    <h1>Do-Connect Admin</h1>
                    <p>User Management System</p>
                </div>
            </div>
            <div class="breadcrumb">
                <a th:href="@{/admin/dashboard}">
                    <i class="fas fa-home"></i>
                    Dashboard
                </a>
                <span>/</span>
                <span>Manage Users</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Page Title -->
        <div class="page-title">
            <h2>
                <div class="title-icon">
                    <i class="fas fa-users-cog"></i>
                </div>
                User Management
            </h2>
        </div>

        <!-- Statistics Bar -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-icon total">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                    <h4 th:text="${#lists.size(users)}">0</h4>
                    <p>Total Users</p>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon active">
                    <i class="fas fa-user-check"></i>
                </div>
                <div class="stat-content">
                    <h4 th:text="${#lists.size(users.?[active])}">0</h4>
                    <p>Active Users</p>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon inactive">
                    <i class="fas fa-user-times"></i>
                </div>
                <div class="stat-content">
                    <h4 th:text="${#lists.size(users.?[!active])}">0</h4>
                    <p>Inactive Users</p>
                </div>
            </div>
        </div>

        <!-- Add New User Form -->
        <div class="add-user-section">
            <div class="section-header">
                <div class="section-icon">
                    <i class="fas fa-user-plus"></i>
                </div>
                Add New User
            </div>
            
            <form th:action="@{/admin/users/add}" method="post">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="name">
                            <i class="fas fa-user"></i>
                            Full Name
                        </label>
                        <input type="text" id="name" name="name" required placeholder="Enter full name"/>
                    </div>

                    <div class="form-group">
                        <label for="email">
                            <i class="fas fa-envelope"></i>
                            Email Address
                        </label>
                        <input type="email" id="email" name="email" required placeholder="Enter email address"/>
                    </div>

                    <div class="form-group">
                        <label for="phone">
                            <i class="fas fa-phone"></i>
                            Phone Number
                        </label>
                        <input type="text" id="phone" name="phone" required placeholder="Enter phone number"/>
                    </div>

                    <div class="form-group">
                        <label for="password">
                            <i class="fas fa-lock"></i>
                            Password
                        </label>
                        <input type="password" id="password" name="password" required 
                               pattern="(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}" 
                               title="Password must be at least 8 characters long and contain at least one letter, one number, and one special character."
                               placeholder="Enter secure password"/>
                    </div>
                </div>

                <button type="submit" class="add-btn">
                    <i class="fas fa-plus"></i>
                    Add User
                </button>
            </form>
        </div>

        <!-- Users Table -->
        <div class="users-section">
            <div class="section-header">
                <div class="section-icon">
                    <i class="fas fa-table"></i>
                </div>
                All Users
            </div>

            <div class="table-container">
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>
                                <i class="fas fa-hashtag"></i>
                                ID
                            </th>
                            <th>
                                <i class="fas fa-user"></i>
                                Name
                            </th>
                            <th>
                                <i class="fas fa-envelope"></i>
                                Email
                            </th>
                            <th>
                                <i class="fas fa-phone"></i>
                                Phone
                            </th>
                            <th>
                                <i class="fas fa-toggle-on"></i>
                                Status
                            </th>
                            <th>
                                <i class="fas fa-edit"></i>
                                Update
                            </th>
                            <th>
                                <i class="fas fa-cogs"></i>
                                Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="user : ${users}">
                            <td>
                                <span class="user-id" th:text="${user.id}">1</span>
                            </td>
                            <td>
                                <span class="user-name" th:text="${user.name}">John Doe</span>
                            </td>
                            <td>
                                <span class="user-email" th:text="${user.email}">john@example.com</span>
                            </td>
                            <td>
                                <span class="user-phone" th:text="${user.phone}">+1234567890</span>
                            </td>
                            <td>
                                <span th:if="${user.active}" class="status-badge active">
                                    <i class="fas fa-check-circle"></i>
                                    Active
                                </span>
                                <span th:if="${!user.active}" class="status-badge inactive">
                                    <i class="fas fa-times-circle"></i>
                                    Inactive
                                </span>
                            </td>
                            <td>
                                <form th:action="@{'/admin/users/update/' + ${user.id}}" method="post" class="update-form">
                                    <input type="text" name="name" th:value="${user.name}" placeholder="Name" required/>
                                    <input type="email" name="email" th:value="${user.email}" placeholder="Email" required/>
                                    <input type="text" name="phone" th:value="${user.phone}" placeholder="Phone" required/>
                                    <button type="submit" class="update-btn">
                                        <i class="fas fa-save"></i>
                                        Update
                                    </button>
                                </form>
                            </td>
                            <td>
                                <a th:if="${user.active}" 
                                   th:href="@{'/admin/users/toggle/' + ${user.id}}" 
                                   class="action-btn deactivate">
                                    <i class="fas fa-user-times"></i>
                                    Deactivate
                                </a>
                                <a th:if="${!user.active}" 
                                   th:href="@{'/admin/users/toggle/' + ${user.id}}" 
                                   class="action-btn activate">
                                    <i class="fas fa-user-check"></i>
                                    Activate
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Back Button -->
        <a th:href="@{/admin/dashboard}" class="back-btn">
            <i class="fas fa-arrow-left"></i>
            Back to Dashboard
        </a>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-info">
                <div class="footer-logo">
                    <i class="fas fa-link"></i>
                    <span>Do-Connect Admin</span>
                </div>
                <p>&copy; 2024 Do-Connect User Management. All rights reserved.</p>
            </div>
            <div class="footer-links">
                <a href="#privacy">Privacy Policy</a>
                <a href="#terms">Terms of Service</a>
                <a href="#support">Support</a>
                <a th:href="@{/admin/dashboard}">Dashboard</a>
                <a th:href="@{/admin/logout}">Logout</a>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add loading states for forms
            document.querySelectorAll('form').forEach(form => {
                form.addEventListener('submit', function(e) {
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                    submitBtn.disabled = true;
                    
                    // Reset after 3 seconds (fallback)
                    setTimeout(() => {
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }, 3000);
                });
            });

            // Add confirmation for deactivate actions
            document.querySelectorAll('.action-btn.deactivate').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    if (!confirm('Are you sure you want to deactivate this user?')) {
                        e.preventDefault();
                    }
                });
            });

            // Add smooth scrolling for form validation errors
            const inputs = document.querySelectorAll('input[required]');
            inputs.forEach(input => {
                input.addEventListener('invalid', function() {
                    this.scrollIntoView({ behavior: 'smooth', block: 'center' });
                });
            });

            // Auto-resize table on window resize
            function adjustTable() {
                const table = document.querySelector('.users-table');
                const container = document.querySelector('.table-container');
                
                if (window.innerWidth < 768) {
                    container.style.fontSize = '0.8rem';
                } else {
                    container.style.fontSize = '1rem';
                }
            }

            window.addEventListener('resize', adjustTable);
            adjustTable(); // Initial call
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97c4ebeef3513f97',t:'MTc1NzQwMjQxMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
